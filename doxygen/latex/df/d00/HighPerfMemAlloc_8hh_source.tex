\hypertarget{HighPerfMemAlloc_8hh_source}{}\doxysection{High\+Perf\+Mem\+Alloc.\+hh}
\label{HighPerfMemAlloc_8hh_source}\index{src/util/HighPerfMemAlloc.hh@{src/util/HighPerfMemAlloc.hh}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{00002 }
\DoxyCodeLine{00003 \textcolor{preprocessor}{\#include "{}DynArray.hh"{}}}
\DoxyCodeLine{00004 \textcolor{keyword}{template} <u\textcolor{keywordtype}{int}32\_t blockSize>}
\DoxyCodeLine{\Hypertarget{HighPerfMemAlloc_8hh_source_l00005}\mbox{\hyperlink{classBlockAllocator}{00005}} \textcolor{keyword}{class }\mbox{\hyperlink{classBlockAllocator}{BlockAllocator}} \{}
\DoxyCodeLine{00006  \textcolor{keyword}{private}:}
\DoxyCodeLine{00007   \textcolor{keyword}{class }Block \{}
\DoxyCodeLine{00008    \textcolor{keyword}{public}:}
\DoxyCodeLine{00009     uint64\_t* p;      \textcolor{comment}{// pointer to the block of memory}}
\DoxyCodeLine{00010     uint32\_t offset;  \textcolor{comment}{// offset to the current memory}}
\DoxyCodeLine{00011     Block(\textcolor{keywordtype}{char}* p, uint32\_t size) : p(p), offset(0) \{\}}
\DoxyCodeLine{00012     \string~Block() \{ \textcolor{keyword}{delete}[] p; \}}
\DoxyCodeLine{00013     Block(\textcolor{keyword}{const} Block\& orig) = \textcolor{keyword}{delete};}
\DoxyCodeLine{00014     Block\& operator=(\textcolor{keyword}{const} Block\& orig) = \textcolor{keyword}{delete};}
\DoxyCodeLine{00015     Block(Block\&\& orig) : p(orig.p), offset(orig.offset) \{ orig.p = \textcolor{keyword}{nullptr}; \}}
\DoxyCodeLine{00016   \};}
\DoxyCodeLine{00017   \mbox{\hyperlink{classDynArray}{DynArray<Block>}} blocks;}
\DoxyCodeLine{00018   uint64\_t* p;       \textcolor{comment}{// pointer to the block of memory}}
\DoxyCodeLine{00019   uint32\_t current;  \textcolor{comment}{// offset to the current memory}}
\DoxyCodeLine{00020  \textcolor{keyword}{public}:}
\DoxyCodeLine{00021   \mbox{\hyperlink{classBlockAllocator}{BlockAllocator}}(uint32\_t size) : blocks(size) \{}
\DoxyCodeLine{00022     p = \textcolor{keyword}{new} \textcolor{keywordtype}{char}[blockSize];}
\DoxyCodeLine{00023     current = 0;}
\DoxyCodeLine{00024   \}}
\DoxyCodeLine{00025   \string~\mbox{\hyperlink{classBlockAllocator}{BlockAllocator}}() \{}
\DoxyCodeLine{00026     \textcolor{keyword}{delete}[] p;  \textcolor{comment}{// delete the current pointer}}
\DoxyCodeLine{00027   \}              \textcolor{comment}{// destructor for DynArray will wipe all the old ones}}
\DoxyCodeLine{00028 }
\DoxyCodeLine{00029   \textcolor{keywordtype}{void}* alloc(uint32\_t size) \{}
\DoxyCodeLine{00030     \textcolor{keywordflow}{if} (blockSize -\/ current < size) \{}
\DoxyCodeLine{00031       blocks.add(Block(p, size));}
\DoxyCodeLine{00032       \textcolor{keywordflow}{if} (size > blockSize) \{}
\DoxyCodeLine{00033         p = \textcolor{keyword}{new} \textcolor{keywordtype}{char}[size];}
\DoxyCodeLine{00034         current = 0;}
\DoxyCodeLine{00035       \}}
\DoxyCodeLine{00036     \}}
\DoxyCodeLine{00037     \textcolor{keywordtype}{char}* temp = p + current;}
\DoxyCodeLine{00038     current += size;}
\DoxyCodeLine{00039     \textcolor{keywordflow}{return} temp;}
\DoxyCodeLine{00040   \}}
\DoxyCodeLine{00041 \};}
\DoxyCodeLine{00042 }
\DoxyCodeLine{00043 \textcolor{keywordtype}{void}* \textcolor{keyword}{operator} \textcolor{keyword}{new}(\textcolor{keywordtype}{size\_t} sz, \mbox{\hyperlink{classBlockAllocator}{BlockAllocator}}* b) \{ \textcolor{keywordflow}{return} b-\/>alloc(sz); \}}

\end{DoxyCode}
